
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSPay - Secure Payment Gateway</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-sub: #64748b;
            --border: #e2e8f0;
            --success: #16a34a;
            --upi-orange: #ff7826;
            --upi-green: #0cb539;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius: 20px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 400px;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            position: relative;
            border: 1px solid var(--border);
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Header Styles --- */
        .header {
            padding: 20px 24px;
            text-align: center;
            border-bottom: 1px solid var(--border);
            background: #fff;
        }

        .logo-area {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 800;
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .trusted-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            background: #ecfdf5;
            color: var(--success);
            padding: 4px 8px;
            border-radius: 99px;
            font-weight: 600;
            border: 1px solid #d1fae5;
        }

        /* --- Content Styles --- */
        .content {
            padding: 24px;
        }

        /* Input Styling */
        .input-group { margin-bottom: 16px; }
        
        .input-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 6px;
        }

        .input-wrapper { position: relative; }
        
        .input-wrapper i {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-sub);
            font-size: 0.9rem;
        }

        .input-field {
            width: 100%;
            padding: 12px 16px 12px 38px;
            border: 1px solid var(--border);
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.2s;
            outline: none;
            background: #fff;
            color: var(--text-main);
        }

        .input-field:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.3);
        }

        .btn-primary:active { transform: translateY(0); }

        .btn-outline {
            background: white;
            border: 1px solid var(--border);
            color: var(--text-main);
        }

        .btn-outline:hover { background: #f8fafc; border-color: #cbd5e1; }

        .btn-action-row {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

        /* --- Payment UI Specifics --- */
        .payment-card-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .merchant-avatar {
            width: 48px;
            height: 48px;
            background: #eff6ff;
            color: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            margin: 0 auto 12px;
            border: 1px solid #dbeafe;
        }

        .amount-box {
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            margin-bottom: 20px;
        }

        .amount-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--text-main);
            letter-spacing: -0.5px;
        }

        .qr-frame {
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 12px;
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            position: relative;
            background: white;
        }
        
        /* QR Scan Lines decoration */
        .qr-frame::after {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            border-radius: 16px;
            border: 2px solid transparent;
            background: linear-gradient(to right, var(--primary), var(--primary)) border-box;
            -webkit-mask: 
                linear-gradient(#fff 0 0) padding-box, 
                linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0.5;
        }

        .qr-frame img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }

        .payment-methods {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
            opacity: 0.7;
        }
        
        .pm-icon {
            font-size: 1.5rem;
            color: var(--text-sub);
        }

        .secure-footer {
            margin-top: 24px;
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-sub);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        /* --- Toast Notification --- */
        #toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1e293b;
            color: white;
            padding: 12px 24px;
            border-radius: 99px;
            font-size: 0.9rem;
            box-shadow: var(--shadow-lg);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
        }
        #toast.show { transform: translateX(-50%) translateY(0); }

        /* Utility */
        .hidden { display: none !important; }
        .text-sm { font-size: 0.85rem; color: var(--text-sub); }
        .font-bold { font-weight: 700; color: var(--text-main); }
        .mb-4 { margin-bottom: 1rem; }
        .w-full { width: 100%; }

        /* Generator Result Box */
        #result-area {
            background: #f1f5f9;
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            border: 1px dashed #94a3b8;
        }
        .url-text {
            word-break: break-all;
            font-family: monospace;
            font-size: 0.8rem;
            color: var(--text-sub);
            margin-bottom: 12px;
            display: block;
        }
    </style>
</head>
<body>

    <!-- Generator View (Admin) -->
    <div id="generator-view" class="container">
        <div class="header">
            <div class="logo-area"><i class="fa-solid fa-bolt"></i> JSPay Admin</div>
            <p class="text-sm">Secure Payment Link Generator</p>
        </div>
        
        <div class="content">
            <form id="gen-form" onsubmit="generateLink(event)">
                <div class="input-group">
                    <label>Receiver UPI ID</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-building-columns"></i>
                        <input type="text" id="vpa" class="input-field" value="josimsekh33@ybl" placeholder="merchant@upi" required>
                    </div>
                </div>

                <div class="input-group">
                    <label>Amount (INR)</label>
                    <div class="input-wrapper">
                        <i class="fa-solid fa-indian-rupee-sign"></i>
                        <input type="number" id="amount" class="input-field" placeholder="0.00" min="1" step="0.01" required>
                    </div>
                </div>

                <div class="input-group">
                    <label>Payment Note</label>
                    <div class="input-wrapper">
                        <i class="fa-regular fa-message"></i>
                        <input type="text" id="note" class="input-field" placeholder="Bill Reference..." maxlength="50">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">
                    <i class="fa-solid fa-link"></i> Create Secure Link
                </button>
            </form>

            <div id="result-area" class="hidden">
                <label class="text-sm font-bold" style="margin-bottom:4px; display:block;">Generated Link:</label>
                <code id="generated-url" class="url-text"></code>
                
                <div class="btn-action-row">
                    <button onclick="copyLink()" class="btn btn-outline" style="flex:1;">
                        <i class="fa-regular fa-copy"></i> Copy
                    </button>
                    <a id="open-link-btn" href="#" target="_blank" class="btn btn-outline" style="flex:1; text-decoration: none;">
                        <i class="fa-solid fa-external-link-alt"></i> Open
                    </a>
                </div>
                
                <button onclick="resetForm()" class="btn btn-outline" style="margin-top: 10px; border: none; background: transparent; color: var(--text-sub); font-size: 0.85rem;">
                    Create Another Link
                </button>
            </div>
        </div>
    </div>

    <!-- Payment View (User) -->
    <div id="payment-view" class="container hidden">
        <!-- Success State -->
        <div id="success-overlay" class="hidden" style="position: absolute; inset:0; background:white; z-index:10; padding:24px; text-align:center; display:flex; flex-direction:column; justify-content:center; align-items:center;">
            <div style="width:80px; height:80px; background:#dcfce7; color:#16a34a; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:40px; margin-bottom:20px;">
                <i class="fa-solid fa-check"></i>
            </div>
            <h2 style="margin-bottom:8px;">Payment Submitted</h2>
            <p class="text-sm" style="margin-bottom:24px;">Your transaction details have been recorded safely.</p>
            <button onclick="window.location.reload()" class="btn btn-outline">Close</button>
        </div>

        <div class="header">
            <div class="logo-area">
                <i class="fa-solid fa-shield-halved"></i> SecurePay
            </div>
            <div class="trusted-badge">
                <i class="fa-solid fa-check-circle"></i> Verified Merchant
            </div>
        </div>

        <div class="content">
            <div class="payment-card-header">
                <p class="text-sm">Paying to</p>
                <div class="font-bold" style="font-size: 1.1rem; margin-top: 4px;" id="disp-vpa">...</div>
            </div>

            <div class="amount-box">
                <p class="text-sm" style="margin-bottom: 4px;">Total Amount</p>
                <div class="amount-value">â‚¹<span id="disp-amount">0</span></div>
                <p class="text-sm" id="disp-note" style="margin-top: 4px; font-style: italic;">...</p>
            </div>

            <div class="qr-frame">
                <!-- Fallback text while loading -->
                <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:0; color:#cbd5e1;">
                    <i class="fa-solid fa-qrcode fa-3x"></i>
                </div>
                <img id="qr-code" src="" alt="QR" style="position:relative; z-index:1;">
            </div>

            <div class="payment-methods">
                <i class="fa-brands fa-google-pay pm-icon"></i>
                <i class="fa-brands fa-amazon-pay pm-icon"></i>
                <i class="fa-solid fa-mobile-screen-button pm-icon"></i>
            </div>

            <a id="pay-btn" href="#" class="btn btn-primary">
                Pay via UPI App <i class="fa-solid fa-arrow-right"></i>
            </a>

            <div style="margin-top: 24px; padding-top: 20px; border-top: 1px dashed var(--border);">
                <div class="input-wrapper">
                    <input type="text" id="utr-input" class="input-field" placeholder="Enter UTR / Ref No. after payment" maxlength="12" style="text-align: center;">
                </div>
                <button onclick="submitUTR()" class="btn btn-outline" style="margin-top: 12px;">
                    Submit Details
                </button>
            </div>

            <div class="secure-footer">
                <i class="fa-solid fa-lock"></i> Secured by NPCI & UPI Standards
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast"><i class="fa-solid fa-circle-info"></i> <span id="toast-msg">Notification</span></div>

    <script>
        // --- Encryption Core ---
        const SALT = "JSPAY_V1_";

        function encryptData(data) {
            try {
                // Add salt and timestamp
                const payload = JSON.stringify({ ...data, ts: Date.now(), s: Math.random().toString(36).substr(2, 5) });
                // Base64 Encode
                let b64 = btoa(payload);
                // Obfuscate: Reverse and simple shift
                let scrambled = b64.split('').reverse().join('');
                scrambled = scrambled.replace(/a/g, '1').replace(/e/g, '2').replace(/i/g, '3'); // Simple char swap
                // URL safe
                return encodeURIComponent(scrambled);
            } catch(e) { return null; }
        }

        function decryptData(hash) {
            try {
                let scrambled = decodeURIComponent(hash);
                // Reverse obfuscation
                scrambled = scrambled.replace(/1/g, 'a').replace(/2/g, 'e').replace(/3/g, 'i');
                let b64 = scrambled.split('').reverse().join('');
                return JSON.parse(atob(b64));
            } catch(e) { return null; }
        }

        // --- Logic ---
        const generatorView = document.getElementById('generator-view');
        const paymentView = document.getElementById('payment-view');

        window.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const payHash = params.get('pay');

            if (payHash) {
                initPaymentMode(payHash);
            } else {
                generatorView.classList.remove('hidden');
            }
        });

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        // --- Generator Functions ---
        function generateLink(e) {
            e.preventDefault();
            const vpa = document.getElementById('vpa').value.trim();
            const amt = document.getElementById('amount').value.trim();
            const note = document.getElementById('note').value.trim();

            if (!vpa || !amt) return showToast("Required fields missing");

            const encrypted = encryptData({ pa: vpa, am: amt, tn: note });
            const url = `${window.location.origin}${window.location.pathname}?pay=${encrypted}`;

            document.getElementById('generated-url').innerText = url;
            document.getElementById('open-link-btn').href = url;
            document.getElementById('result-area').classList.remove('hidden');
            showToast("Link Generated!");
        }

        function copyLink() {
            const txt = document.getElementById('generated-url').innerText;
            navigator.clipboard.writeText(txt).then(() => showToast("Copied!"));
        }

        function resetForm() {
            document.getElementById('gen-form').reset();
            document.getElementById('result-area').classList.add('hidden');
        }

        // --- Payment Functions ---
        function initPaymentMode(hash) {
            const data = decryptData(hash);
            
            if (!data || !data.pa) {
                showToast("Invalid Link");
                setTimeout(() => window.location.href = window.location.pathname, 2000);
                return;
            }

            generatorView.classList.add('hidden');
            paymentView.classList.remove('hidden');

            // Set UI Data
            document.getElementById('disp-vpa').innerText = data.pa;
            document.getElementById('disp-amount').innerText = data.am;
            document.getElementById('disp-note').innerText = data.tn || "Payment";

            // Construct Deep Link
            // IMPORTANT: 'pn' (Payee Name) is recommended. Using 'Merchant' generic.
            // URL Encoding is crucial for the QR API to read the full string.
            const upiRaw = `upi://pay?pa=${data.pa}&pn=Merchant&am=${data.am}&tn=${encodeURIComponent(data.tn || '')}&cu=INR`;
            
            // Set Button
            document.getElementById('pay-btn').href = upiRaw;

            // Generate QR using QuickChart (Reliable, handles URL encoding well)
            // Using ecLevel=M (Medium error correction) and margin=1
            const qrApi = `https://quickchart.io/qr?text=${encodeURIComponent(upiRaw)}&size=300&ecLevel=M&margin=1&centerImageUrl=https://upload.wikimedia.org/wikipedia/commons/thumb/e/e1/UPI-Logo-vector.svg/1200px-UPI-Logo-vector.svg.png&centerImageSizeRatio=0.2`;
            
            // Fallback to simpler QR if complex one fails (handled by onerror not strictly needed but good practice)
            // Or use goqr.me as backup: `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(upiRaw)}`
            
            document.getElementById('qr-code').src = qrApi;
        }

        function submitUTR() {
            const utr = document.getElementById('utr-input').value.trim();
            if (utr.length < 4) return showToast("Enter valid UTR");
            
            // Show Success Overlay
            document.getElementById('success-overlay').classList.remove('hidden');
            document.getElementById('success-overlay').style.display = 'flex';
        }
    </script>
</body>
</html>


